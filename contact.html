<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Khevin Russell - Contact Me</title>
    <link rel="stylesheet" href="styles.css">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <style>
        /* ⭐ STAR RATING */
        .rating-label {
            margin-top: 10px;
            margin-bottom: 6px;
            display: block;
            font-weight: 600;
            color: #ffa347;
        }

        .rating {
            display: flex;
            gap: 6px;
            justify-content: flex-start;
            margin-bottom: 15px;
        }

        .rating span {
            font-size: 32px;
            cursor: pointer;
            transition: transform .2s ease, color .2s ease;
            color: #555;
            user-select: none;
        }

        .rating span:hover {
            transform: scale(1.25);
            color: orange;
        }

        .rating span.active {
            color: #ffa347;
            text-shadow: 0 0 8px rgba(255,165,0,0.7);
        }

        .rating-display {
            margin-top: 15px;
            margin-bottom: 40px;
            color: #ccc;
            font-size: 14px;
        }

        #successMsg {
            display: none;
            margin-top: 10px;
            font-weight: bold;
        }
    </style>
</head>

<body>

<!-- NAVIGATION -->
<nav>
    <div class="container">
        <div class="logo">Khevin<span>.dev</span></div>
        <ul>
            <li><a href="index.html">About Me</a></li>
            <li><a href="skills.html">Skills</a></li>
            <li><a href="projects.html">Projects</a></li>
            <li><a class="active" href="contact.html">Contact Me</a></li>
        </ul>
    </div>
</nav>

<!-- CONTACT SECTION -->
<section class="contact-section">
<div class="contact-container">

    <!-- LEFT SIDE -->
    <div class="contact-left fade-up">

        <h2 class="contact-title">Get In Touch</h2>
        <div class="orange-line"></div>

        <h3 class="contact-subtitle">Let’s work together!</h3>
        <p class="contact-desc">
            I'm always interested in new opportunities and exciting projects.
            Whether you have a question or just want to say hi, feel free to reach out!
        </p>

        <div class="contact-info">
            <p><i class="fas fa-envelope"></i> russellkhevin035@gmail.com</p>
            <p><i class="fas fa-phone"></i> +639648787265</p>
            <p><i class="fas fa-map-marker-alt"></i> Philippines, Angeles City, Pampanga, Amsic Purok 1</p>
        </div>

        <div class="rating-display">
            ⭐ <span id="avgRating">0.0</span> / 5 • <span id="totalRatings">0</span> ratings
        </div>

        <div class="contact-socials">
            <div class="social-links">
                <a href="https://github.com/russellkhevin035-byte" target="_blank" class="icon-container">
                    <i class="fa-brands fa-github"></i>
                </a>
                <a href="#" target="_blank" class="icon-container">
                    <i class="fa-brands fa-facebook"></i>
                </a>
                <a href="mailto:russellkhevin035@gmail.com" class="icon-container">
                    <i class="fa-solid fa-envelope"></i>
                </a>
                <a href="tel:09648787265" class="icon-container">
                    <i class="fa-solid fa-phone"></i>
                </a>
            </div>

            <p>&copy; 2025 Khevin Russell. All rights reserved.</p>
        </div>
    </div>

    <!-- RIGHT SIDE FORM -->
    <form id="contactForm" class="contact-form">

        <div class="form-group">
            <input type="text" name="name" placeholder="Your Name" required>
        </div>

        <div class="form-group">
            <input type="email" name="email" placeholder="Your Email" required>
        </div>

        <div class="form-group">
            <input type="text" name="subject" placeholder="Subject" required>
        </div>

        <div class="form-group">
            <textarea name="message" placeholder="Your Message" required></textarea>
        </div>

        <!-- ⭐ STAR RATING -->
        <label class="rating-label">Rate My Portfolio</label>
        <div class="rating" id="ratingStars">
            <span data-value="5">★</span>
            <span data-value="4">★</span>
            <span data-value="3">★</span>
            <span data-value="2">★</span>
            <span data-value="1">★</span>
        </div>

        <input type="hidden" name="rating" id="ratingInput">

        <button type="submit" class="send-btn">Send Message</button>

        <p id="successMsg" class="success-msg">Thank you for contacting me!</p>

    </form>

</div>
</section>


<!-- ⭐ FIREBASE + FORMSPREE + GMAIL VALIDATION ⭐ -->
<script type="module">

/* FIREBASE SETUP */
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs } 
from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";

const firebaseConfig = {
    apiKey: "AIzaSyAN1iAGK4EPWZ82WKiuWTNvZYFxxszJW88",
    authDomain: "starrating-b6c33.firebaseapp.com",
    projectId: "starrating-b6c33",
    storageBucket: "starrating-b6c33.firebasestorage.app",
    messagingSenderId: "585139648598",
    appId: "1:585139648598:web:8e483379fed557602623f7",
    measurementId: "G-ZLYQ2BW6TK"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);


/* ⭐ STAR RATING LOGIC */
const ratingInput = document.getElementById("ratingInput");
const stars = document.querySelectorAll("#ratingStars span");

stars.forEach(star => {
    star.addEventListener("click", () => {
        const value = star.dataset.value;
        ratingInput.value = value;

        stars.forEach(s => s.classList.remove("active"));
        stars.forEach(s => {
            if (s.dataset.value <= value) s.classList.add("active");
        });
    });

    star.addEventListener("mouseenter", () => {
        const value = star.dataset.value;
        stars.forEach(s => s.style.color = s.dataset.value <= value ? "orange" : "#555");
    });

    star.addEventListener("mouseleave", () => {
        stars.forEach(s => s.style.color = s.classList.contains("active") ? "#ffa347" : "#555");
    });
});


/* ⭐ LOAD AVERAGE RATING */
async function loadRatingStats() {
    const snapshot = await getDocs(collection(db, "ratings"));
    let total = 0, count = 0;

    snapshot.forEach(doc => {
        total += doc.data().rating;
        count++;
    });

    document.getElementById("avgRating").innerText = count ? (total / count).toFixed(1) : "0.0";
    document.getElementById("totalRatings").innerText = count;
}
loadRatingStats();


/* ⭐ GMAIL VALIDATION */
function isValidGmail(email) {
    const pattern = /^[a-zA-Z0-9._%+-]+@gmail\.com$/;
    if (!pattern.test(email)) return false;

    const user = email.split("@")[0];

    const banned = [
        /^test/, /^fake/, /^admin/, /^sample/,
        /^temp/, /^asdf/, /^qwerty/,
        /^\d+$/, /(111|000|123)$/
    ];

    return !banned.some(p => p.test(user));
}


/* ⭐ FORM SUBMISSION */
const form = document.getElementById("contactForm");
const successMsg = document.getElementById("successMsg");

form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const formData = new FormData(form);
    const email = formData.get("email").trim();

    const name = formData.get("name").trim();
    const subject = formData.get("subject").trim();
    const message = formData.get("message").trim();
    const rating = ratingInput.value;

    if (!name || !email || !subject || !message) {
        successMsg.textContent = "Please fill in all fields.";
        successMsg.style.color = "red";
        successMsg.style.display = "block";
        return;
    }

    if (!isValidGmail(email)) {
        successMsg.textContent = "Please enter a valid Gmail address.";
        successMsg.style.color = "red";
        successMsg.style.display = "block";
        return;
    }

    /* SEND TO FORMSPREE */
    let res = await fetch("https://formspree.io/f/xyzrbkvb", {
        method: "POST",
        body: formData,
        headers: { "Accept": "application/json" }
    });

    if (!res.ok) {
        successMsg.textContent = "Something went wrong. Please try again.";
        successMsg.style.color = "red";
        successMsg.style.display = "block";
        return;
    }

    /* SAVE RATING */
    if (rating) {
        await addDoc(collection(db, "ratings"), {
            rating: parseInt(rating),
            timestamp: Date.now()
        });
        loadRatingStats();
    }

    successMsg.textContent = "Message sent successfully!";
    successMsg.style.color = "lightgreen";
    successMsg.style.display = "block";

    form.reset();
    stars.forEach(s => s.classList.remove("active"));
});

</script>

</body>
</html>
